<div class="grid justify-items-center mb-5" data-controller="archivo">
  <div class="flex w-full"> 
        <div class="w-1/5"></div>
        <div class="w-7/12 border-2 border-gray-200">
                <div class="p-1 text-center border border-gray-200 border-b-2 border-t-0 border-l-0 border-r-0 font-bold">
                              Protocolo
                </div>
                <div class="p-2 text-left text-sm font-bold text-blue-800">
                   <span class="cursor-pointer" data-action="click->archivo#agreraCamposEl" data-archivo-idproyecto-param = '<%= @proyecto.id %>' data-archivo-tipo-param = 'protocolo' > 
                        + Agregar otro archivo...
                   </span>
                </div>
                <div class="p-1 bg-slate-200">
                      <div id="cont_protocolo" class="md:w-full ml-3">
                          <% 
                             if @proyecto.docprotocolos.attached? %>
                                   <% @proyecto.docprotocolos.each do |item|
                          %>
                                   <div class="item flex border border-gray-400 border-b-2 border-t-0 border-l-0 border-r-0 w-full">
                                        <div class="flex text-wrap w-9/12">  
                                                <%= link_to item.filename, rails_blob_path(item, disposition:'inline'), target:'_blank', class:'item_file text-blue-700' %>
                                        </div>                        
                                        <div class="flex items-center justify-center w-3/12 text-red-700">
                                                <span data-action="click->archivo#quitarArch"  data-archivo-id-param = '<%= item.id %>'  data-archivo-action-param = 'listel'>Quitar</span>
                                        </div>                           
                                   </div>
                             <% end %>
                          <% end %>      
                      </div> 
                </div>
                
        </div>
  </div>      
</div>


<div class="border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">
    <%= form_with model:@proyecto do |form| %>
        <input type="hidden" name="el_prot" value="elprot_edit">
        <div class="md:flex md:items-center mb-3 ">
                <div class="md:w-1/5">
                        <div class='md:text-right mb-1 md:mb-0 pr-4' id="proyecto_protocolos"></div>
                </div>
                <div class="md:w-3/5 p-0">
                                <div class="font-semibold flex"> <div class="ml-3">Protocolo:</div> </div>
                                <div id = "div_file" class="md:w-full ml-3 p-2" data-controller="upsf">
                                        
                                        
                                                <% if @proyecto.docprotocolo.attached? %>
                                                        <%= form.file_field :docprotocolo, class:'item_file mb-3', style:'display:none;', direct_upload: true, data: { upsf_target: "input", action: "change->upsf#uploadFile"} %>
                                                        <%= link_to @proyecto.docprotocolo.filename, rails_blob_path(@proyecto.docprotocolo, disposition:'inline'), target:'_blank', class:'item_file text-blue-800' %>
                                                        <button type="button" class='item_file ml-2 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-2 py-2 text-center inline-flex items-center mr-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800'  data-action='click->upsf#delFileEdit' data-upsf-idpy-param='<%= @proyecto.docprotocolo.id %>'>Reemplazar...</button>
                                                <% else %>
                                                        <%= form.file_field :docprotocolo, class:'item_file', direct_upload: true, data: { upsf_target: "input", action: "change->upsf#uploadFile"} %>
                                                <% end %>
                                                
                                        
                                </div>
                </div>       
        </div>
        <div class="md:flex-col md:items-center mb-3">
                        <div class="md:w-1/5">
                                        <div class='md:text-right mb-1 md:mb-0 pr-4'></div>
                        </div>
                        <div class="md:w-2/5 p-0">
                                <div class="font-semibold flex"> <div><%= inline_svg_tag 'svg/historia.svg' %></div> <div class="ml-3">Hist√≥rico</div></div>
                        </div>    
                        <div class="flex-col ml-5">
                           <% if Dhistorico.where(record_id:@proyecto.id, record_type:'Proyecto', name:'docprotocolo').any? %>  
                                <% Dhistorico.where(record_id:@proyecto.id, record_type:'Proyecto', name:'docprotocolo').each do |item|  %> 
                                        <%  b =  ActiveStorage::Blob.find(item.blob_id) %>
                                        <div class="flex"> 
                                        <div class="ml-5"><%= link_to b.filename, rails_blob_path(b, disposition:'inline'), target:'_blank', class:'item_file text-gray-500' %></div>
                                        <div class="ml-2 text-gray-500"> <%= b.created_at.strftime("%d-%m-%Y") %> </div>
                                        </div>   

                                <% end %>
                           <% else %>     
                                   <div class="ml-5 text-gray-500 italic">No hay archivos</div>
                           <% end %>
                        </div>
        </div>
        <div class="md:flex md:items-center justify-end border-t-2 border-gray-100 p-2">
                                <button type="submit" class="text-white bg-green-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800" 
                                        data-turbo-frame= 'py_content_secc' 
                                        >
                                Aplicar cambios
                                </button>
        </div>
   <% end %>      
</div>        