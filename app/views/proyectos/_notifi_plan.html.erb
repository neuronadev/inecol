<%
      validacion = @proyecto.validaciones.includes(:tvalidacion).where('tvalidaciones.clave':'SOLV').last
%>

<div class="w-full p-1  bg-white border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">
   <h5 class="mb-1 text-xl font-semibold tracking-tight text-gray-900 dark:text-white">Proyecto</h5>
   <p class="mb-1 font-normal text-gray-500 dark:text-gray-400">Información</p>

   <div class="flex justify-center" data-controller="mautorizado">
     <table class="table-auto w-9/12 ">
         <tbody>
                   <%= render "proyectos/tr", titulo:'Nombre del Proyecto:', valor: @proyecto.nombre  %>
                   <%= render "proyectos/tr", titulo:'Responsable Técnico:', valor: @proyecto.participante.pacademicos.where(responsable:true).first.academico.persona.ap_nom_prop %>

                   <tr class="">
                         <td class="font-semibold p-2 text-right border-b border-slate-300" style='width:300px;'>Convenio Firmado:</td>
                         <td class="p-2 border-b border-slate-300">
                              <%= render 'proyectos/planconv' %>
                         </td>
                   </tr>
                   <tr class="bg-gray-300">
                        <td colspan="2" class="font-semibold p-1 border-b border-slate-300" style='width:300px;'>
                              <div class="grid grid-cols-5 gap-5">
                                   <div class="col-start-2 col-span-3 grid justify-items-center">Monto Autorizado</div>
                                   <div class="grid justify-items-end font-medium">
                                         <span class='font-semibold' data-turbo-action="replace" data-action='click->mautorizado#agregar' data-mautorizado-idpy-param="<%= @proyecto.id %>">+ Agregar...</span>
                                   </div>
                              </div> 
                        </td>
                   </tr>
                   <tr>
                       <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                            <%= turbo_frame_tag "monto_autorizado" do %>
                                      <% if !@proyecto.mtoautorizado.nil? %> 
                                               <%= turbo_frame_tag "preview_monto_autorizado", src:preview_proyecto_mtoautorizado_path(@proyecto, @proyecto.mtoautorizado) do %>
                                               <% end %> 
                                      <% else %>          
                                               <span class="italic">Sin asignar</span>
                                      <% end %>
                            <% end %>
                       </td>     
                   </tr>
                  

                  <!--                     
                   <% if !@proyecto.mtoautorizado.nil? %> 
                        <tr>
                           <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                              <%= render 'mtoautorizados/vautorizado' %>
                           </td>
                        <tr>
                   <% else %>
                          <tr>
                           <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                                 <span class="italic">Sin asignar</span>
                           </td>
                        <tr>
                   <% end %>
                   -->
                   <tr class="bg-gray-300">
                        <td colspan="2" class="font-semibold p-1 text-center border-b border-slate-300" style='width:300px;'>Monto Ejercido</td>
                   </tr>
                   <% if @proyecto.mtoejercidos.any? %> 
                        <tr>
                           <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                              <%= render 'mtoautorizados/vejercido' %>
                           </td>
                        <tr>
                   <% else %>
                          <tr>
                           <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                                 <span class="italic">Sin asignar</span>
                           </td>
                        <tr>
                   <% end %>
                   <tr class="bg-gray-300">
                        <td colspan="2" class="font-semibold p-1 text-center border-b border-slate-300" style='width:300px;'>Monto Concurrente </td>
                   </tr>
                   <% if @proyecto.recurso.omitir.nil? %> 
                       <% if !@proyecto.recurso.concurrentes.blank? %> 
                              <tr>
                                   <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                                        
                                        <%= render partial: '/proyectos/pdf/recursos', formats:[:html], locals:{items:@proyecto.recurso.concurrentes} %>
                                        
                                   </td>
                              <tr>
                       <% else %>            
                              <tr>
                                    <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                                        <span class="italic">Sin recursos</span>
                                    </td>
                              <tr>
                       <% end %>            
                   <% else %>
                          <tr>
                           <td colspan="2" class="font-semibold p-2 text-center border-b border-slate-300" style='width:300px;'>  
                                 <span class="italic">Sin recursos</span>
                           </td>
                        <tr>
                   <% end %>

         </tbody>   
      </table>
  </div>
</div> 